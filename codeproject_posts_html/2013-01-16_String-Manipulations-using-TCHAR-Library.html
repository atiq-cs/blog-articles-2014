<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--------------------------------------------------------------------------->  
<!--                           INTRODUCTION                                

 The Code Project article submission template (HTML version)

Using this template will help us post your article sooner. To use, just 
follow the 3 easy steps below:
 
     1. Fill in the article description details
     2. Add links to your images and downloads
     3. Include the main article text

That's all there is to it! All formatting will be done by our submission
scripts and style sheets. 

-->  
<!--------------------------------------------------------------------------->  
<!--                        IGNORE THIS SECTION                            -->
<html>
<head>
<title>The Code Project</title>
<Style>
BODY, P, TD { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10pt }
H2,H3,H4,H5 { color: #ff9900; font-weight: bold; }
H2 { font-size: 13pt; }
H3 { font-size: 12pt; }
H4 { font-size: 10pt; color: black; }
PRE { BACKGROUND-COLOR: #FBEDBB; FONT-FAMILY: "Courier New", Courier, mono; WHITE-SPACE: pre; }
CODE { COLOR: #990000; FONT-FAMILY: "Courier New", Courier, mono; }
</style>
<link rel="stylesheet" type="text/css" href="http://www.codeproject.com/App_Themes/NetCommunity/CodeProject.css">
</head>
<body bgcolor="#FFFFFF" color=#000000>
<!--------------------------------------------------------------------------->  


<!-------------------------------     STEP 1      --------------------------->
<!--  Fill in the details (CodeProject will reformat this section for you) -->

<pre>
Title:       String manipulations in Unicode
Author:      Saint Atique
Email:       unix9n@gmail.com
Language:    WinAPI, VC++, MFC
Platform:    Windows
Technology:  MFC
Level:       Beginner
Description: Tricks and trips on String manipulations in Unicode (Windows Programming context)
Section      Windows
SubSection   Visual C++
License:     GPL v3
</pre>

<!-------------------------------     STEP 2      --------------------------->
<!--  Include download and sample image information.                       --> 


<!-------------------------------     STEP 3      --------------------------->

<!--  Add the article text. Please use simple formatting (<h2>, <p> etc)   -->

<h2>Introduction</h2>

<p>Whether you write a Win32 application or MFC application you may want to add Unicode support. Unicode gives you the freedom to include texts from any language in your application. So how to manipulate these strings in Unicode? I show you how.</p>

<h2>Using the code</h2>

<p>Sorry, this tricks and tips doesn't include code. Rather I give some hints for beginners here.</p>

<p>To use a Unicode string in as a function parameter, wrap it with function _T or TEXT macro. For example,</p>

<pre>AfxMessageBox(_T("You clicked it!"));</pre>

<p>Whenever you use Unicode try to avoid the string data type char or <code>char*</code>. Because before using them in your controls you have to convert them. And repetitive conversion may be tedious.</p>

<p>Use <code>TCHAR</code> instead of char and use <code>TCHAR*</code> instead of <code>char*</code>. <code>TCHAR*</code> can be written <code>LPTSTR</code> . For const <code>TCHAR*</code> you may write <code>LPCTSTR</code>  which in required when a string is passed as an argument to a function where modification should be restricted.</p>

<p>To calculate length of strings use _tcslen function,</p>
<pre>len = _tcslen(str);</pre>

<p>To compare strings instead of strcmp and strncmp use _tcscmp  and _tcsncmp. Here’s an example</p>
<pre>if (!_tcsncmp(line, _T("desiredtext"), 11))
	AfxMessageBox(_T(“Got desired text.”));
</pre>

<p>For copying string _tcscpy_s and _tcsncpy_s instead of strcpy and strncpy</p>
<pre>_tcsncpy_s(dest, srcstr, 20);</pre>

<p>Note, strpy or _tcscpy_s don’t put a null after copying the string so remember to set null after copying the string when required.</p>

<p> For string concatenation use _tcscat_s and _tcsncat_s instead of strcat and strncat. Here 2nd parameter is the size of the destination string.</p>
<pre>_tcsncat_s(timestamp, 20, str, i);</pre>

<p>For splitting tokens use _tcstok_s instead of strtok.</p>
<pre><code>LPTSTR</code>  next_token;
token = _tcstok_s(str, delim, &next_token);</pre>

<p>There is another issue with Unicode is that some functions are not available for example atoi. There is a way to convert from wide chars to integer demonstrated in msdn but I didn’t find for CString or <code>LPTSTR</code> . So here’s a function I wrote to to perform atoi,</p>

<pre>int GetEquivValue(<code>TCHAR</code> ch, int base) {
	int diff = _T('a') - _T('A');

	// Invalid base
	if (base &gt;= 16)
		return 0;

	if (base == 16) {
		// make upper case if lowercase
		if (ch &gt;= _T('a') && ch &lt;= _T('z'))
			ch -= diff;

		diff = _T('A') - _T('0');

		if (ch &gt;= _T('A') && ch &lt;= _T('F'))
			return (ch-diff);
	}

	if (ch &gt;= _T('0') && ch &lt;= _T('9'))
		return (ch - _T('0'));
	return 0;
}

int SAatoib(<code>LPTSTR</code>  str, int base) {
	int res = 0;
	int i, len, tmp;

	len = _tcslen(str);
	for (i=0; i&lt;len; i++) {
		tmp = GetEquivValue(str[i], base);
		res = res*base + tmp;
	}
	return res;
}
</pre>

<p>To convert a string to decimal number use,</p>
<pre>int decVal = SAatoib((<code>LPTSTR</code> )NumStr, 10);</pre>

<p>To convert a string to hexadecimal number use,</p>
<pre>int decVal = SAatoib((<code>LPTSTR</code> )NumStr, 16);</pre>

<p>To convert a string to octal number use,</p>
<pre>int decVal = SAatoib((<code>LPTSTR</code> )NumStr, 8);</pre>

<p>To format the string like printf you can always use CString::Format function. For example, to get IP address,</p>
<pre>unsigned long int ipsegval[4] = {1, 2, 3, 4};
CString ip;
ip.Format(_T("%u.%u.%u.%u"), ipsegval[0], ipsegval[1], ipsegval[2], ipsegval[3]);
</pre>

<p>Now for example, you have a CString. But you need it as const <code>char*</code> or <code>char*</code>
The cast to <code>LPCTSTR</code>  from CString is valid one but cast to const <code>char*</code> isn’t valid. But there is a way. Here’s an example,
</p>
<pre>CString ipaddrstr(_T(“1.2.3.4”));
CStringA ipaddrstrA(ipaddrstr);
ipaddr = inet_addr(ipaddrstrA);
</pre>

<h2>Points of Interest</h2>

<p>I know there is another approach using wide characters always. That also that restricts the application to run on earlier operating systems like Windows XP if that doesn’t have Unicode support installed.
The reason of this post is that many beginners cannot find an easy way to understand how to manipulate Unicode in windows applications properly.
</p>

<h2>History</h2>

<p>...</p>

<!-------------------------------    That's it!   --------------------------->
</body>

</html>
